<html>
  <head>
    <title>ramendan</title>
    <script type="text/javascript" src="http://use.typekit.com/oqd2vvf.js"></script>
    <script type="text/javascript">try{Typekit.load()}catch(e){}</script>

    <script type="text/template" id="layout">
      <html>
        <head>
          <style>
            body {
              color: white;
      
              background: -moz-linear-gradient(center top, #CF2900 0%, #000 40%);
              background: -webkit-gradient(linear, 0% 0%, 0% 40%, from(#CF2900), to(#000000));
              background-color: #000;
            } 
          </style>
        </head>
        <body>
          <div id="container">
            <h1 class="tk-neuzon">Ramendan</h1>
            #{this}
          </div>
        </body>  
      </html>
    </script>

    <script type="text/template" id="latestUsers">
      <p>Latest users:</p>
      <ul>
        #{this.map(templates.latestUser)}
      </ul>
    </script>

    <script type="text/template" id="latestUser">
      <li>
        <img src="#{this.img}">
        <a href="/followers/#{this.handle}">#{this.name}</a> (<a href="/followers/#{this.handle}">#{this.handle}</a>)
      </li>
    </script>    

    <script type="text/template" id="latestEntries">
      <p>Latest entries:</p>
      <ul>
        #{this.map(templates.latestEntry)}
      </ul>
    </script>

    <script type="text/template" id="latestEntry">
      <li>
        <img src="#{this.img}">
        #{JSON.stringify(this)}
      </li>
    </script>    

    <script type="text/template" id="user">
      <script src="http://widgets.twimg.com/j/2/widget.js"></scr#{''}ipt>
      <script>
      new TWTR.Widget({
        version: 2,
        type: 'search',
        search: 'from:#{this.handle} ramendan',
        interval: 6000,
        title: '',
        subject: 'Recent offerings:',
        width: 250,
        height: 300,
        theme: {
          shell: {
            background: '#000000',
            color: '#ffffff'
          },
          tweets: {
            background: '#000000',
            color: '#ffffff',
            links: '#ffffff'
          }
        },
        features: {
          scrollbar: true,
          loop: false,
          live: false,
          hashtags: true,
          timestamp: true,
          avatars: false,
          toptweets: false,
          behavior: 'all'
        }
      }).render().start();
      </scr#{''}ipt>
      <div>
        <div><img src="#{this.img}"></div>
        <div>name: #{this.name}</div>
        <div>handle: #{this.handle}</div>
        <div>blurb: #{this.blurb}</div>
        <div>lang: #{this.lang}</div>
        <div>entries: #{JSON.stringify(this.entries)}</div>
      </div>
    </script>    
  </head>
  <body>
    <script>
       jsonp =
       function e(a,b,c,d){with(document)body.appendChild(createElement(d="script")).src=a+(c=d+(e.a=-~e.a));(a=window)[c]=function(d){a[c]=b(d)}}

       template =
       function(a,b){return function(c,d){return a.replace(/#{([^}]*)}/g,function(a,e){return Function("x","with(x)return "+e).call(c,d||b||{})})}}
       
       route = 
       function(a,b,c){function e(d){d=location.pathname;if(d!=c){for(b=0,c=d;(d=a[b++])&&!(d=d.exec(c));b++);a[b](d)}};e();setInterval(e,b||99)}
       
       getTemplates =
       function(a,b,c,d){for(a={},b=document.getElementsByTagName("script"),c=0;d=b[c++];/pt$/.test(d.type||"pt")||(a[d.id]=d.innerHTML));return a}
       
       map = 
       Array.prototype.map=[].map||function(a){for(var b,c=this,d=Array(b=c.length),e=0;e<b;)d[e]=e in c&&a.call(arguments[1],c[e],e++,c);return d}
       
       write =
       function(a,b,c){c=a.nodeType;c>8?a.close(a.open(),a.write(b)):a[[,"innerHTML","value"][c]||"nodeValue"]=b}
       
       templates = getTemplates()
       for (var name in templates) {
         templates[name] = template(templates[name], {templates: templates} )
       }
       
       onload = function() {
       
         route([
           /^\/$/,
           function() {
             jsonp( "http://ramendan.com/api?callback=", function( data ) {
               write( document, templates.layout(
                 templates.latestUsers( data.users ) +
                 templates.latestEntries( data.entries )
               ))
             })
           },

           /^\/followers\/(\w+)$/,
           function(capture) {
             jsonp( "http://ramendan.com/api/users/" + capture[1] + "?callback=", function( data ) {
               jsonp( "http://ramendan.com/api/users/" + capture[1] + "/entries?callback=", function( entries ) {
                 data.entries = entries
                 write( document, templates.layout( templates.user( data ) ) )
               })
             })
           },
           
           /* 404 */,
           function() {
             write( document, templates.layout("404") )
           }
         ])
       }

    </script>
  </body>
</html>