<html>
  <head>
    <title>ramendan</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> 
<!-- 
    <script type="text/javascript" src="http://use.typekit.com/oqd2vvf.js"></script>
    <script type="text/javascript">try{Typekit.load()}catch(e){}</script>
 -->

    <script type="text/template" id="layout" lang="en">
      <html>
        <head>
          <script type="text/javascript">
          (function() {
            if (window.__twitterIntentHandler) return;
            var intentRegex = /twitter\.com(\:\d{2,4})?\/intent\/(\w+)/,
                windowOptions = 'scrollbars=yes,resizable=yes,toolbar=no,location=yes',
                width = 550,
                height = 420,
                winHeight = screen.height,
                winWidth = screen.width;
          
            function handleIntent(e) {
              e = e || window.event;
              var target = e.target || e.srcElement,
                  m, left, top;
          
              while (target && target.nodeName.toLowerCase() !== 'a') {
                target = target.parentNode;
              }
          
              if (target && target.nodeName.toLowerCase() === 'a' && target.href) {
                m = target.href.match(intentRegex);
                if (m) {
                  left = Math.round((winWidth / 2) - (width / 2));
                  top = 0;
          
                  if (winHeight > height) {
                    top = Math.round((winHeight / 2) - (height / 2));
                  }
          
                  window.open(target.href, 'intent', windowOptions + ',width=' + width +
                                                     ',height=' + height + ',left=' + left + ',top=' + top);
                  e.returnValue = false;
                  e.preventDefault && e.preventDefault();
                }
              }
            }
          
            if (document.addEventListener) {
              document.addEventListener('click', handleIntent, false);
            } else if (document.attachEvent) {
              document.attachEvent('onclick', handleIntent);
            }
            window.__twitterIntentHandler = true;
          }());
          </scr#{''}ipt>
          <style>
            body {
              color: white;
      
              background: -moz-linear-gradient(center top, #CF2900 0%, #000 40%);
              background: -webkit-gradient(linear, 0% 0%, 0% 40%, from(#CF2900), to(#000000));
              background-color: #000;
            } 
          </style>
        </head>
        <body>
          <div id="container">#{this}</div>
        </body>
      </html>
    </script>
    
    <script type="text/template" id="layout" lang="ja">
      <html>
        <head>
          <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> 
          <script type="text/javascript">
          (function() {
            if (window.__twitterIntentHandler) return;
            var intentRegex = /twitter\.com(\:\d{2,4})?\/intent\/(\w+)/,
                windowOptions = 'scrollbars=yes,resizable=yes,toolbar=no,location=yes',
                width = 550,
                height = 420,
                winHeight = screen.height,
                winWidth = screen.width;
          
            function handleIntent(e) {
              e = e || window.event;
              var target = e.target || e.srcElement,
                  m, left, top;
          
              while (target && target.nodeName.toLowerCase() !== 'a') {
                target = target.parentNode;
              }
          
              if (target && target.nodeName.toLowerCase() === 'a' && target.href) {
                m = target.href.match(intentRegex);
                if (m) {
                  left = Math.round((winWidth / 2) - (width / 2));
                  top = 0;
          
                  if (winHeight > height) {
                    top = Math.round((winHeight / 2) - (height / 2));
                  }
          
                  window.open(target.href, 'intent', windowOptions + ',width=' + width +
                                                     ',height=' + height + ',left=' + left + ',top=' + top);
                  e.returnValue = false;
                  e.preventDefault && e.preventDefault();
                }
              }
            }
          
            if (document.addEventListener) {
              document.addEventListener('click', handleIntent, false);
            } else if (document.attachEvent) {
              document.attachEvent('onclick', handleIntent);
            }
            window.__twitterIntentHandler = true;
          }());
          </scr#{''}ipt>
          <style>
            body {
              color: white;
      
              background: -moz-linear-gradient(center top, #CF2900 0%, #000 40%);
              background: -webkit-gradient(linear, 0% 0%, 0% 40%, from(#CF2900), to(#000000));
              background-color: #000;
            } 
          </style>
        </head>
        <body>
          <div id="container">#{this}</div>
        </body>
      </html>
    </script>

    <script type="text/template" id="index" lang="en">
      <h1 class="tk-neuzon">Ramendan</h1>
      #{templates.latestUsers(this.users)}
      #{templates.latestEntries(this.entries)}
    </script>

    <script type="text/template" id="index" lang="ja">
      <h1>ラーメンダン</h1>
    </script>

    <script type="text/template" id="latestUsers" lang="en">
      <p>Latest users:</p>
      <ul>
        #{this.map(templates.latestUser)}
      </ul>
    </script>

    <script type="text/template" id="latestUser" lang="en">
      <li>
        <img src="#{this.img}">
        <a href="/followers/#{this.handle}">#{this.name}</a> (<a href="/followers/#{this.handle}">#{this.handle}</a>)
      </li>
    </script>    

    <script type="text/template" id="latestEntries" lang="en">
      <p>Latest entries:</p>
      <ul>
        #{this.map(templates.latestEntry)}
      </ul>
    </script>

    <script type="text/template" id="latestEntry" lang="en">
      <li>
        <img width="#{this.thumbWidth}"
             height="#{this.thumbHeight}" 
             src="#{this.thumb}">
        <img width="#{this.thumbWidth}"
             height="#{this.thumbHeight}"
             src="http://maps.google.com/maps/api/staticmap?center=#{this.lat},#{this.lng}&zoom=8&size=#{this.thumbWidth}x#{this.thumbHeight}&sensor=false">
        #{JSON.stringify(this)}
      </li>
    </script>    

    <script type="text/template" id="user" lang="en">
      <script src="http://widgets.twimg.com/j/2/widget.js"></scr#{''}ipt>
      <script>
      new TWTR.Widget({
        version: 2,
        type: 'search',
        search: 'from:#{this.handle} ramendan',
        interval: 6000,
        title: '',
        subject: 'Recent offerings:',
        width: 250,
        height: 300,
        theme: {
          shell: {
            background: '#000000',
            color: '#ffffff'
          },
          tweets: {
            background: '#000000',
            color: '#ffffff',
            links: '#ffffff'
          }
        },
        features: {
          scrollbar: true,
          loop: false,
          live: false,
          hashtags: true,
          timestamp: true,
          avatars: false,
          toptweets: false,
          behavior: 'all'
        }
      }).render().start();
      </scr#{''}ipt>
      <div>
        <div><img src="#{this.img}"></div>
        <div>name: #{this.name}</div>
        <div>handle: #{this.handle}</div>
        <div>blurb: #{this.blurb}</div>
        <div>lang: #{this.lang}</div>
        
        <table>
          <tr>
            <th>MON</th>
            <th>TUE</th>
            <th>WED</th>
            <th>THU</th>
            <th>FRI</th>
            <th>SAT</th>
            <th>SUN</th>
          </tr>
          </tr>
            <td colspan="6"></td>
            <td>7/31</td>
          </tr>
          <tr>
            <td>8/1</td>
            <td>8/2</td>
            <td>8/3</td>
            <td>8/4</td>
            <td>8/5</td>
            <td>8/6</td>
            <td>8/7</td>
          </tr>
          <tr>
            <td>8/8</td>
            <td>8/9</td>
            <td>8/10</td>
            <td>8/11</td>
            <td>8/12</td>
            <td>8/13</td>
            <td>8/14</td>
          </tr>
          <tr>
            <td>8/15</td>
            <td>8/16</td>
            <td>8/17</td>
            <td>8/18</td>
            <td>8/19</td>
            <td>8/20</td>
            <td>8/21</td>
          </tr>
          <tr>
            <td>8/22</td>
            <td>8/23</td>
            <td>8/24</td>
            <td>8/25</td>
            <td>8/26</td>
            <td>8/27</td>
            <td>8/28</td>
          </tr>
          <tr>
            <td>8/29</td>
            <td colspan="6"></td>
          </tr>
        </table>
        
        <div>entries: #{JSON.stringify(this.entries)}</div>
      </div>
    </script>    
  </head>
  <body>
    <script>
       jsonp =
       function e(a,b,c,d){with(document)body.appendChild(createElement(d="script")).src=a+(c=d+(e.a=-~e.a));(a=window)[c]=function(d){a[c]=b(d)}}

       template =
       function(a,b){return function(c,d){return a.replace(/#{([^}]*)}/g,function(a,e){return Function("x","with(x)return "+e).call(c,d||b||{})})}}
       
       route = 
       function(a,b,c){function e(d){d=location.pathname;if(d!=c){for(b=0,c=d;(d=a[b++])&&!(d=d.exec(c));b++);a[b](d)}};e();setInterval(e,b||99)}
       
       getTemplates =
       function(a,b,c,d,e){for(b=document.getElementsByTagName(c="script"),d=0;e=b[d++];)e.src||/ipt$/.test(e.type||c)||a.call(e,e.innerHTML,e.id)}
       
       map = 
       Array.prototype.map=[].map||function(a){for(var b,c=this,d=Array(b=c.length),e=0;e<b;)d[e]=e in c&&a.call(arguments[1],c[e],e++,c);return d}
       
       write =
       function(a,b,c){c=a.nodeType;c>8?a.close(a.open(),a.write(b)):a[[,"innerHTML","value"][c]||"nodeValue"]=b}
       
       
       templates = { en:{}, ja:{} }
       getTemplates(function(val, name) {
         templates[this.lang][name] = template(val, {templates: templates[this.lang]} )
       })
       
       route([
         /^\/$/,
         function() {
           jsonp( "http://ramendan.com/api?callback=", function( body ) {
             write( document, templates[body.lang].layout(
               templates[body.lang].index( body.data )
             ))
           })
         },

         /^\/followers\/(\w+)$/,
         function(capture) {
           jsonp( "http://ramendan.com/api/users/" + capture[1] + "?callback=", function( body ) {
             write( document, templates[body.lang].layout( templates[body.lang].user( body.data ) ) )
           })
         },
         
         /* 404 */,
         function() {
           write( document, templates.layout("404") )
         }
       ])

    </script>
  </body>
</html>